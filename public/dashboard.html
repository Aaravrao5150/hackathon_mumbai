<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="style.css">
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>

<script src="firebase-init.js"></script>
</head>

<body>

<div class="nav">SMART ATTENDANCE SYSTEM</div>

<div class="card">

<h2>Attendance Overview</h2>

<div id="summary"></div>

<h3>Sessions</h3>
<div id="roster"></div>

</div>

<script>
async function load(){

 let u=auth.currentUser;
 let roll=u.email.split("@")[0];

 let att=await db.collection("attendance")
   .where("roll","==",roll).get();

 let total=0, present=0;

 att.forEach(a=>{
   total++;
   if(a.data().status!="ABSENT") present++;
 });

 let percent = total?Math.round(present/total*100):0;

 summary.innerHTML=
   `<h3>${percent}% Attendance</h3>
    <p>${present} of ${total} sessions</p>`;

 let html="";
 att.forEach(a=>{
   html+=`${a.data().session} - ${a.data().status}<br>`;
 });

 roster.innerHTML=html;
}

auth.onAuthStateChanged(load);
</script>

</body>
</html>
